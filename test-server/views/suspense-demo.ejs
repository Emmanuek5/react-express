<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Suspense & Router Demo - React Express</title>
    <style>
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .demo-card {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .loading-placeholder {
        padding: 20px;
        background: #f5f5f5;
        border-radius: 4px;
        text-align: center;
        color: #666;
      }
      .nav-links {
        margin: 20px 0;
      }
      .nav-links a {
        margin-right: 15px;
        padding: 8px 15px;
        text-decoration: none;
        color: #333;
        background: #f0f0f0;
        border-radius: 4px;
      }
      .nav-links a:hover {
        background: #e0e0e0;
      }
      .profile-card {
        display: flex;
        gap: 20px;
      }
      .profile-avatar {
        width: 100px;
        height: 100px;
        background: #ddd;
        border-radius: 50%;
      }
      .profile-info {
        flex: 1;
      }
      .skills-list {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .skill-tag {
        background: #e0e0e0;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container" data-content>
      <h1>Suspense & Router Demo</h1>

      <!-- Navigation -->
      <div class="demo-card">
        <h2>Navigation</h2>
        <div class="nav-links">
          <a href="/" data-route>Home</a>
          <a href="/about" data-route>About</a>
          <a href="/contact" data-route prefetch>Contact</a>
        </div>
      </div>

      <!-- User Profile with Suspense -->
      <div class="demo-card">
        <h2>User Profile</h2>
        <div
          data-suspense="/api/user-profile"
          data-placeholder="<div class='loading-placeholder'>Loading user profile...</div>"
        >
          <script>
            ReactExpress.subscribe(
              "userProfile",
              (profile) => `
              <div class="profile-card">
                <div class="profile-avatar"></div>
                <div class="profile-info">
                  <h3>${profile.user.fullName}</h3>
                  <p>${profile.role}</p>
                  <div>
                    <strong>Contact:</strong>
                    <div>${profile.user.contact.email}</div>
                    <div>${profile.user.contact.phone}</div>
                  </div>
                  <div style="margin-top: 10px;">
                    <strong>Skills:</strong>
                    <div class="skills-list">
                      ${profile.user.skills
                        .map(
                          (skill) => `
                        <span class="skill-tag">${skill}</span>
                      `
                        )
                        .join("")}
                    </div>
                  </div>
                </div>
              </div>
            `
            );
          </script>
        </div>
      </div>

      <!-- Weather Widget with Error Boundary -->
      <div class="demo-card">
        <h2>Weather Widget</h2>
        <div
          data-suspense="/api/weather"
          data-error-boundary="weatherError"
          data-placeholder="<div class='loading-placeholder'>Loading weather data...</div>"
        >
          <script>
            ReactExpress.subscribe(
              "weather",
              (data) => `
              <div class="weather-widget">
                <h3>${data.location}</h3>
                <div class="weather-info">
                  <div class="temperature">${data.temperature}Â°C</div>
                  <div class="condition">${data.condition}</div>
                </div>
              </div>
            `
            );

            function weatherError(error) {
              return `
                <div class="error-boundary">
                  <p>Failed to load weather data</p>
                  <button onclick="retryWeather()">Retry</button>
                </div>
              `;
            }

            function retryWeather() {
              ReactExpress.retry("/api/weather");
            }
          </script>
        </div>
      </div>

      <!-- Nested Suspense -->
      <div class="demo-card">
        <h2>Dashboard</h2>
        <div
          data-suspense="/api/dashboard"
          data-placeholder="<div class='loading-placeholder'>Loading dashboard...</div>"
        >
          <div class="dashboard-widgets">
            <!-- Nested suspense components will load in parallel -->
            <div
              data-suspense="/api/stats"
              data-placeholder="<div class='loading-placeholder'>Loading stats...</div>"
            ></div>
            <div
              data-suspense="/api/notifications"
              data-placeholder="<div class='loading-placeholder'>Loading notifications...</div>"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Router event handlers
      ReactExpress.router.onBeforeNavigate((to, from) => {
        console.log(`Navigating from ${from} to ${to}`);
        return true; // Return false to prevent navigation
      });

      ReactExpress.router.onAfterNavigate((to) => {
        console.log(`Navigation to ${to} completed`);
      });

      // Prefetch some routes
      ReactExpress.router.prefetch("/about");
    </script>
  </body>
</html>
